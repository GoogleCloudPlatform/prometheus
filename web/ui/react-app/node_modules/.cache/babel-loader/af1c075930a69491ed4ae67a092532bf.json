{"ast":null,"code":"import _toConsumableArray from\"/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{PureComponent}from'react';import SeriesName from'./SeriesName';export var Legend=/*#__PURE__*/function(_PureComponent){_inherits(Legend,_PureComponent);var _super=_createSuper(Legend);function Legend(){var _this;_classCallCheck(this,Legend);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={selectedIndexes:[]};_this.handleSeriesSelect=function(index){return function(ev){// TODO: add proper event type\nvar selectedIndexes=_this.state.selectedIndexes;var selected=[index];if(ev.ctrlKey||ev.metaKey){var chartData=_this.props.chartData;if(selectedIndexes.includes(index)){selected=selectedIndexes.filter(function(idx){return idx!==index;});}else{selected=// Flip the logic - In case none is selected ctrl + click should deselect clicked series.\nselectedIndexes.length===0?chartData.reduce(function(acc,_,i){return i===index?acc:[].concat(_toConsumableArray(acc),[i]);},[]):[].concat(_toConsumableArray(selectedIndexes),[index]);// Select multiple.\n}}else if(selectedIndexes.length===1&&selectedIndexes.includes(index)){selected=[];}_this.setState({selectedIndexes:selected});_this.props.onSeriesToggle(selected,index);};};return _this;}_createClass(Legend,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.shouldReset&&prevProps.shouldReset!==this.props.shouldReset){this.setState({selectedIndexes:[]});}}},{key:\"render\",value:function render(){var _this2=this;var _this$props=this.props,chartData=_this$props.chartData,onLegendMouseOut=_this$props.onLegendMouseOut,onHover=_this$props.onHover;var selectedIndexes=this.state.selectedIndexes;var canUseHover=chartData.length>1&&selectedIndexes.length===0;return/*#__PURE__*/React.createElement(\"div\",{className:\"graph-legend\",onMouseOut:canUseHover?onLegendMouseOut:undefined},chartData.map(function(_ref){var index=_ref.index,color=_ref.color,labels=_ref.labels;return/*#__PURE__*/React.createElement(\"div\",{style:{opacity:selectedIndexes.length===0||selectedIndexes.includes(index)?1:0.5},onClick:chartData.length>1?_this2.handleSeriesSelect(index):undefined,onMouseOver:canUseHover?onHover(index):undefined,key:index,className:\"legend-item\"},/*#__PURE__*/React.createElement(\"span\",{className:\"legend-swatch\",style:{backgroundColor:color}}),/*#__PURE__*/React.createElement(SeriesName,{labels:labels,format:true}));}),chartData.length>1&&/*#__PURE__*/React.createElement(\"div\",{className:\"pl-1 mt-1 text-muted\",style:{fontSize:13}},\"Click: select series, \",navigator.platform.includes('Mac')?'CMD':'CTRL',\" + click: toggle multiple series\"));}}]);return Legend;}(PureComponent);","map":{"version":3,"sources":["/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/src/pages/graph/Legend.tsx"],"names":["React","PureComponent","SeriesName","Legend","state","selectedIndexes","handleSeriesSelect","index","ev","selected","ctrlKey","metaKey","chartData","props","includes","filter","idx","length","reduce","acc","_","i","setState","onSeriesToggle","prevProps","shouldReset","onLegendMouseOut","onHover","canUseHover","undefined","map","color","labels","opacity","backgroundColor","fontSize","navigator","platform"],"mappings":"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","sourcesContent":["import React, { PureComponent, SyntheticEvent } from 'react';\nimport SeriesName from './SeriesName';\nimport { GraphSeries } from './Graph';\n\ninterface LegendProps {\n  chartData: GraphSeries[];\n  shouldReset: boolean;\n  onLegendMouseOut: (ev: SyntheticEvent<HTMLDivElement>) => void;\n  onSeriesToggle: (selected: number[], index: number) => void;\n  onHover: (index: number) => (ev: SyntheticEvent<HTMLDivElement>) => void;\n}\n\ninterface LegendState {\n  selectedIndexes: number[];\n}\n\nexport class Legend extends PureComponent<LegendProps, LegendState> {\n  state = {\n    selectedIndexes: [] as number[],\n  };\n  componentDidUpdate(prevProps: LegendProps) {\n    if (this.props.shouldReset && prevProps.shouldReset !== this.props.shouldReset) {\n      this.setState({ selectedIndexes: [] });\n    }\n  }\n  handleSeriesSelect = (index: number) => (ev: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    // TODO: add proper event type\n    const { selectedIndexes } = this.state;\n\n    let selected = [index];\n    if (ev.ctrlKey || ev.metaKey) {\n      const { chartData } = this.props;\n      if (selectedIndexes.includes(index)) {\n        selected = selectedIndexes.filter(idx => idx !== index);\n      } else {\n        selected =\n          // Flip the logic - In case none is selected ctrl + click should deselect clicked series.\n          selectedIndexes.length === 0\n            ? chartData.reduce<number[]>((acc, _, i) => (i === index ? acc : [...acc, i]), [])\n            : [...selectedIndexes, index]; // Select multiple.\n      }\n    } else if (selectedIndexes.length === 1 && selectedIndexes.includes(index)) {\n      selected = [];\n    }\n\n    this.setState({ selectedIndexes: selected });\n    this.props.onSeriesToggle(selected, index);\n  };\n\n  render() {\n    const { chartData, onLegendMouseOut, onHover } = this.props;\n    const { selectedIndexes } = this.state;\n    const canUseHover = chartData.length > 1 && selectedIndexes.length === 0;\n\n    return (\n      <div className=\"graph-legend\" onMouseOut={canUseHover ? onLegendMouseOut : undefined}>\n        {chartData.map(({ index, color, labels }) => (\n          <div\n            style={{ opacity: selectedIndexes.length === 0 || selectedIndexes.includes(index) ? 1 : 0.5 }}\n            onClick={chartData.length > 1 ? this.handleSeriesSelect(index) : undefined}\n            onMouseOver={canUseHover ? onHover(index) : undefined}\n            key={index}\n            className=\"legend-item\"\n          >\n            <span className=\"legend-swatch\" style={{ backgroundColor: color }}></span>\n            <SeriesName labels={labels} format />\n          </div>\n        ))}\n        {chartData.length > 1 && (\n          <div className=\"pl-1 mt-1 text-muted\" style={{ fontSize: 13 }}>\n            Click: select series, {navigator.platform.includes('Mac') ? 'CMD' : 'CTRL'} + click: toggle multiple series\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}