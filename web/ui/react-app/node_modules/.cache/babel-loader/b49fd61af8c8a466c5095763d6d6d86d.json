{"ast":null,"code":"import _createForOfIteratorHelper from \"/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _classCallCheck from \"/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { ViewPlugin, Direction, EditorView, logException } from '@codemirror/view';\nimport { Facet, StateEffect, StateField, MapMode } from '@codemirror/state';\nvar ios = typeof navigator != \"undefined\" && !/Edge\\/(\\d+)/.exec(navigator.userAgent) && /Apple Computer/.test(navigator.vendor) && (/Mobile\\/\\w+/.test(navigator.userAgent) || navigator.maxTouchPoints > 2);\nvar Outside = \"-10000px\";\nvar tooltipPlugin = ViewPlugin.fromClass( /*#__PURE__*/function () {\n  function _class(view) {\n    var _this = this;\n\n    _classCallCheck(this, _class);\n\n    this.view = view;\n    this.inView = true;\n    this.measureReq = {\n      read: this.readMeasure.bind(this),\n      write: this.writeMeasure.bind(this),\n      key: this\n    };\n    this.input = view.state.facet(showTooltip);\n    this.tooltips = this.input.filter(function (t) {\n      return t;\n    });\n    this.tooltipViews = this.tooltips.map(function (tp) {\n      return _this.createTooltip(tp);\n    });\n  }\n\n  _createClass(_class, [{\n    key: \"update\",\n    value: function update(_update) {\n      var input = _update.state.facet(showTooltip);\n\n      if (input == this.input) {\n        var _iterator = _createForOfIteratorHelper(this.tooltipViews),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var t = _step.value;\n            if (t.update) t.update(_update);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      } else {\n        var _tooltips = input.filter(function (x) {\n          return x;\n        });\n\n        var views = [];\n\n        for (var i = 0; i < _tooltips.length; i++) {\n          var tip = _tooltips[i],\n              known = -1;\n          if (!tip) continue;\n\n          for (var _i = 0; _i < this.tooltips.length; _i++) {\n            var other = this.tooltips[_i];\n            if (other && other.create == tip.create) known = _i;\n          }\n\n          if (known < 0) {\n            views[i] = this.createTooltip(tip);\n          } else {\n            var tooltipView = views[i] = this.tooltipViews[known];\n            if (tooltipView.update) tooltipView.update(_update);\n          }\n        }\n\n        var _iterator2 = _createForOfIteratorHelper(this.tooltipViews),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _t = _step2.value;\n            if (views.indexOf(_t) < 0) _t.dom.remove();\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n\n        this.input = input;\n        this.tooltips = _tooltips;\n        this.tooltipViews = views;\n        this.maybeMeasure();\n      }\n    }\n  }, {\n    key: \"createTooltip\",\n    value: function createTooltip(tooltip) {\n      var tooltipView = tooltip.create(this.view);\n      tooltipView.dom.classList.add(\"cm-tooltip\"); // FIXME drop this on the next breaking release\n\n      if (tooltip.class) tooltipView.dom.classList.add(tooltip.class);\n      tooltipView.dom.style.top = Outside;\n      this.view.dom.appendChild(tooltipView.dom);\n      if (tooltipView.mount) tooltipView.mount(this.view);\n      return tooltipView;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var _iterator3 = _createForOfIteratorHelper(this.tooltipViews),\n          _step3;\n\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var dom = _step3.value.dom;\n          dom.remove();\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n  }, {\n    key: \"readMeasure\",\n    value: function readMeasure() {\n      var _this2 = this;\n\n      return {\n        editor: this.view.dom.getBoundingClientRect(),\n        pos: this.tooltips.map(function (t) {\n          return _this2.view.coordsAtPos(t.pos);\n        }),\n        size: this.tooltipViews.map(function (_ref) {\n          var dom = _ref.dom;\n          return dom.getBoundingClientRect();\n        }),\n        innerWidth: window.innerWidth,\n        innerHeight: window.innerHeight\n      };\n    }\n  }, {\n    key: \"writeMeasure\",\n    value: function writeMeasure(measured) {\n      var editor = measured.editor;\n\n      for (var i = 0; i < this.tooltipViews.length; i++) {\n        var tooltip = this.tooltips[i],\n            tView = this.tooltipViews[i],\n            dom = tView.dom;\n        var pos = measured.pos[i],\n            size = measured.size[i]; // Hide tooltips that are outside of the editor.\n\n        if (!pos || pos.bottom <= editor.top || pos.top >= editor.bottom || pos.right <= editor.left || pos.left >= editor.right) {\n          dom.style.top = Outside;\n          continue;\n        }\n\n        var width = size.right - size.left,\n            height = size.bottom - size.top;\n        var left = this.view.textDirection == Direction.LTR ? Math.min(pos.left, measured.innerWidth - width) : Math.max(0, pos.left - width);\n        var above = !!tooltip.above;\n        if (!tooltip.strictSide && (above ? pos.top - (size.bottom - size.top) < 0 : pos.bottom + (size.bottom - size.top) > measured.innerHeight)) above = !above;\n\n        if (ios) {\n          dom.style.top = (above ? pos.top - height : pos.bottom) - editor.top + \"px\";\n          dom.style.left = left - editor.left + \"px\";\n          dom.style.position = \"absolute\";\n        } else {\n          dom.style.top = (above ? pos.top - height : pos.bottom) + \"px\";\n          dom.style.left = left + \"px\";\n        }\n\n        dom.classList.toggle(\"cm-tooltip-above\", above);\n        dom.classList.toggle(\"cm-tooltip-below\", !above);\n        if (tView.positioned) tView.positioned();\n      }\n    }\n  }, {\n    key: \"maybeMeasure\",\n    value: function maybeMeasure() {\n      if (this.tooltips.length) {\n        if (this.view.inView || this.inView) this.view.requestMeasure(this.measureReq);\n        this.inView = this.view.inView;\n      }\n    }\n  }]);\n\n  return _class;\n}(), {\n  eventHandlers: {\n    scroll: function scroll() {\n      this.maybeMeasure();\n    }\n  }\n});\nvar baseTheme = EditorView.baseTheme({\n  \".cm-tooltip\": {\n    position: \"fixed\",\n    zIndex: 100\n  },\n  \"&light .cm-tooltip\": {\n    border: \"1px solid #ddd\",\n    backgroundColor: \"#f5f5f5\"\n  },\n  \"&dark .cm-tooltip\": {\n    backgroundColor: \"#333338\",\n    color: \"white\"\n  }\n}); // FIXME backward-compat shim. Delete on next major version.\n\n/**\n@internal\n*/\n\nfunction tooltips() {\n  return [];\n}\n/**\nBehavior by which an extension can provide a tooltip to be shown.\n*/\n\n\nvar showTooltip = Facet.define({\n  enables: [tooltipPlugin, baseTheme]\n});\nvar HoverTime = 750,\n    HoverMaxDist = 6;\n\nvar HoverPlugin = /*#__PURE__*/function () {\n  function HoverPlugin(view, source, field, setHover) {\n    _classCallCheck(this, HoverPlugin);\n\n    this.view = view;\n    this.source = source;\n    this.field = field;\n    this.setHover = setHover;\n    this.lastMouseMove = null;\n    this.hoverTimeout = -1;\n    this.restartTimeout = -1;\n    this.pending = null;\n    this.checkHover = this.checkHover.bind(this);\n    view.dom.addEventListener(\"mouseleave\", this.mouseleave = this.mouseleave.bind(this));\n    view.dom.addEventListener(\"mousemove\", this.mousemove = this.mousemove.bind(this));\n  }\n\n  _createClass(HoverPlugin, [{\n    key: \"update\",\n    value: function update() {\n      var _this3 = this;\n\n      if (this.pending) {\n        this.pending = null;\n        clearTimeout(this.restartTimeout);\n        this.restartTimeout = setTimeout(function () {\n          return _this3.startHover();\n        }, 20);\n      }\n    }\n  }, {\n    key: \"active\",\n    get: function get() {\n      return this.view.state.field(this.field);\n    }\n  }, {\n    key: \"checkHover\",\n    value: function checkHover() {\n      this.hoverTimeout = -1;\n      if (this.active) return;\n      var now = Date.now(),\n          lastMove = this.lastMouseMove;\n      if (now - lastMove.timeStamp < HoverTime) this.hoverTimeout = setTimeout(this.checkHover, HoverTime - (now - lastMove.timeStamp));else this.startHover();\n    }\n  }, {\n    key: \"startHover\",\n    value: function startHover() {\n      var _this4 = this;\n\n      var _a;\n\n      clearTimeout(this.restartTimeout);\n      var lastMove = this.lastMouseMove;\n      var coords = {\n        x: lastMove.clientX,\n        y: lastMove.clientY\n      };\n      var pos = this.view.contentDOM.contains(lastMove.target) ? this.view.posAtCoords(coords) : null;\n      if (pos == null) return;\n      var posCoords = this.view.coordsAtPos(pos);\n      if (posCoords == null || coords.y < posCoords.top || coords.y > posCoords.bottom || coords.x < posCoords.left - this.view.defaultCharacterWidth || coords.x > posCoords.right + this.view.defaultCharacterWidth) return;\n      var bidi = this.view.bidiSpans(this.view.state.doc.lineAt(pos)).find(function (s) {\n        return s.from <= pos && s.to >= pos;\n      });\n      var rtl = bidi && bidi.dir == Direction.RTL ? -1 : 1;\n      var open = this.source(this.view, pos, coords.x < posCoords.left ? -rtl : rtl);\n\n      if ((_a = open) === null || _a === void 0 ? void 0 : _a.then) {\n        var pending = this.pending = {\n          pos: pos\n        };\n        open.then(function (result) {\n          if (_this4.pending == pending) {\n            _this4.pending = null;\n            if (result) _this4.view.dispatch({\n              effects: _this4.setHover.of(result)\n            });\n          }\n        }, function (e) {\n          return logException(_this4.view.state, e, \"hover tooltip\");\n        });\n      } else if (open) {\n        this.view.dispatch({\n          effects: this.setHover.of(open)\n        });\n      }\n    }\n  }, {\n    key: \"mousemove\",\n    value: function mousemove(event) {\n      var _a;\n\n      this.lastMouseMove = event;\n      if (this.hoverTimeout < 0) this.hoverTimeout = setTimeout(this.checkHover, HoverTime);\n      var tooltip = this.active;\n\n      if (tooltip && !isInTooltip(event.target) || this.pending) {\n        var _ref2 = tooltip || this.pending,\n            pos = _ref2.pos,\n            end = (_a = tooltip === null || tooltip === void 0 ? void 0 : tooltip.end) !== null && _a !== void 0 ? _a : pos;\n\n        if (pos == end ? this.view.posAtCoords({\n          x: event.clientX,\n          y: event.clientY\n        }) != pos : !isOverRange(this.view, pos, end, event.clientX, event.clientY, HoverMaxDist)) {\n          this.view.dispatch({\n            effects: this.setHover.of(null)\n          });\n          this.pending = null;\n        }\n      }\n    }\n  }, {\n    key: \"mouseleave\",\n    value: function mouseleave() {\n      clearTimeout(this.hoverTimeout);\n      this.hoverTimeout = -1;\n      if (this.active) this.view.dispatch({\n        effects: this.setHover.of(null)\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      clearTimeout(this.hoverTimeout);\n      this.view.dom.removeEventListener(\"mouseleave\", this.mouseleave);\n      this.view.dom.removeEventListener(\"mousemove\", this.mousemove);\n    }\n  }]);\n\n  return HoverPlugin;\n}();\n\nfunction isInTooltip(elt) {\n  for (var cur = elt; cur; cur = cur.parentNode) {\n    if (cur.nodeType == 1 && cur.classList.contains(\"cm-tooltip\")) return true;\n  }\n\n  return false;\n}\n\nfunction isOverRange(view, from, to, x, y, margin) {\n  var range = document.createRange();\n  var fromDOM = view.domAtPos(from),\n      toDOM = view.domAtPos(to);\n  range.setEnd(toDOM.node, toDOM.offset);\n  range.setStart(fromDOM.node, fromDOM.offset);\n  var rects = range.getClientRects();\n  range.detach();\n\n  for (var i = 0; i < rects.length; i++) {\n    var rect = rects[i];\n    var dist = Math.max(rect.top - y, y - rect.bottom, rect.left - x, x - rect.right);\n    if (dist <= margin) return true;\n  }\n\n  return false;\n}\n/**\nEnable a hover tooltip, which shows up when the pointer hovers\nover ranges of text. The callback is called when the mouse hovers\nover the document text. It should, if there is a tooltip\nassociated with position `pos` return the tooltip description\n(either directly or in a promise). The `side` argument indicates\non which side of the position the pointer is—it will be -1 if the\npointer is before the position, 1 if after the position.\n*/\n\n\nfunction hoverTooltip(source) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var setHover = StateEffect.define();\n  var hoverState = StateField.define({\n    create: function create() {\n      return null;\n    },\n    update: function update(value, tr) {\n      if (value && options.hideOnChange && (tr.docChanged || tr.selection)) return null;\n\n      var _iterator4 = _createForOfIteratorHelper(tr.effects),\n          _step4;\n\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var effect = _step4.value;\n          if (effect.is(setHover)) return effect.value;\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n\n      if (value && tr.docChanged) {\n        var newPos = tr.changes.mapPos(value.pos, -1, MapMode.TrackDel);\n        if (newPos == null) return null;\n        var copy = Object.assign(Object.create(null), value);\n        copy.pos = newPos;\n        if (value.end != null) copy.end = tr.changes.mapPos(value.end);\n        return copy;\n      }\n\n      return value;\n    },\n    provide: function provide(f) {\n      return showTooltip.from(f);\n    }\n  });\n  return [hoverState, ViewPlugin.define(function (view) {\n    return new HoverPlugin(view, source, hoverState, setHover);\n  })];\n}\n\nexport { hoverTooltip, showTooltip, tooltips };","map":{"version":3,"sources":["/usr/local/google/home/freinartz/repos/src/github.com/GoogleCloudPlatform/prometheus-clean/web/ui/react-app/node_modules/@codemirror/tooltip/dist/index.js"],"names":["ViewPlugin","Direction","EditorView","logException","Facet","StateEffect","StateField","MapMode","ios","navigator","exec","userAgent","test","vendor","maxTouchPoints","Outside","tooltipPlugin","fromClass","view","inView","measureReq","read","readMeasure","bind","write","writeMeasure","key","input","state","facet","showTooltip","tooltips","filter","t","tooltipViews","map","tp","createTooltip","update","x","views","i","length","tip","known","other","create","tooltipView","indexOf","dom","remove","maybeMeasure","tooltip","classList","add","class","style","top","appendChild","mount","editor","getBoundingClientRect","pos","coordsAtPos","size","innerWidth","window","innerHeight","measured","tView","bottom","right","left","width","height","textDirection","LTR","Math","min","max","above","strictSide","position","toggle","positioned","requestMeasure","eventHandlers","scroll","baseTheme","zIndex","border","backgroundColor","color","define","enables","HoverTime","HoverMaxDist","HoverPlugin","source","field","setHover","lastMouseMove","hoverTimeout","restartTimeout","pending","checkHover","addEventListener","mouseleave","mousemove","clearTimeout","setTimeout","startHover","active","now","Date","lastMove","timeStamp","_a","coords","clientX","y","clientY","contentDOM","contains","target","posAtCoords","posCoords","defaultCharacterWidth","bidi","bidiSpans","doc","lineAt","find","s","from","to","rtl","dir","RTL","open","then","result","dispatch","effects","of","e","event","isInTooltip","end","isOverRange","removeEventListener","elt","cur","parentNode","nodeType","margin","range","document","createRange","fromDOM","domAtPos","toDOM","setEnd","node","offset","setStart","rects","getClientRects","detach","rect","dist","hoverTooltip","options","hoverState","value","tr","hideOnChange","docChanged","selection","effect","is","newPos","changes","mapPos","TrackDel","copy","Object","assign","provide","f"],"mappings":"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","sourcesContent":["import { ViewPlugin, Direction, EditorView, logException } from '@codemirror/view';\nimport { Facet, StateEffect, StateField, MapMode } from '@codemirror/state';\n\nconst ios = typeof navigator != \"undefined\" &&\n    !/Edge\\/(\\d+)/.exec(navigator.userAgent) && /Apple Computer/.test(navigator.vendor) &&\n    (/Mobile\\/\\w+/.test(navigator.userAgent) || navigator.maxTouchPoints > 2);\nconst Outside = \"-10000px\";\nconst tooltipPlugin = ViewPlugin.fromClass(class {\n    constructor(view) {\n        this.view = view;\n        this.inView = true;\n        this.measureReq = { read: this.readMeasure.bind(this), write: this.writeMeasure.bind(this), key: this };\n        this.input = view.state.facet(showTooltip);\n        this.tooltips = this.input.filter(t => t);\n        this.tooltipViews = this.tooltips.map(tp => this.createTooltip(tp));\n    }\n    update(update) {\n        let input = update.state.facet(showTooltip);\n        if (input == this.input) {\n            for (let t of this.tooltipViews)\n                if (t.update)\n                    t.update(update);\n        }\n        else {\n            let tooltips = input.filter(x => x);\n            let views = [];\n            for (let i = 0; i < tooltips.length; i++) {\n                let tip = tooltips[i], known = -1;\n                if (!tip)\n                    continue;\n                for (let i = 0; i < this.tooltips.length; i++) {\n                    let other = this.tooltips[i];\n                    if (other && other.create == tip.create)\n                        known = i;\n                }\n                if (known < 0) {\n                    views[i] = this.createTooltip(tip);\n                }\n                else {\n                    let tooltipView = views[i] = this.tooltipViews[known];\n                    if (tooltipView.update)\n                        tooltipView.update(update);\n                }\n            }\n            for (let t of this.tooltipViews)\n                if (views.indexOf(t) < 0)\n                    t.dom.remove();\n            this.input = input;\n            this.tooltips = tooltips;\n            this.tooltipViews = views;\n            this.maybeMeasure();\n        }\n    }\n    createTooltip(tooltip) {\n        let tooltipView = tooltip.create(this.view);\n        tooltipView.dom.classList.add(\"cm-tooltip\");\n        // FIXME drop this on the next breaking release\n        if (tooltip.class)\n            tooltipView.dom.classList.add(tooltip.class);\n        tooltipView.dom.style.top = Outside;\n        this.view.dom.appendChild(tooltipView.dom);\n        if (tooltipView.mount)\n            tooltipView.mount(this.view);\n        return tooltipView;\n    }\n    destroy() {\n        for (let { dom } of this.tooltipViews)\n            dom.remove();\n    }\n    readMeasure() {\n        return {\n            editor: this.view.dom.getBoundingClientRect(),\n            pos: this.tooltips.map(t => this.view.coordsAtPos(t.pos)),\n            size: this.tooltipViews.map(({ dom }) => dom.getBoundingClientRect()),\n            innerWidth: window.innerWidth,\n            innerHeight: window.innerHeight\n        };\n    }\n    writeMeasure(measured) {\n        let { editor } = measured;\n        for (let i = 0; i < this.tooltipViews.length; i++) {\n            let tooltip = this.tooltips[i], tView = this.tooltipViews[i], { dom } = tView;\n            let pos = measured.pos[i], size = measured.size[i];\n            // Hide tooltips that are outside of the editor.\n            if (!pos || pos.bottom <= editor.top || pos.top >= editor.bottom || pos.right <= editor.left || pos.left >= editor.right) {\n                dom.style.top = Outside;\n                continue;\n            }\n            let width = size.right - size.left, height = size.bottom - size.top;\n            let left = this.view.textDirection == Direction.LTR ? Math.min(pos.left, measured.innerWidth - width)\n                : Math.max(0, pos.left - width);\n            let above = !!tooltip.above;\n            if (!tooltip.strictSide &&\n                (above ? pos.top - (size.bottom - size.top) < 0 : pos.bottom + (size.bottom - size.top) > measured.innerHeight))\n                above = !above;\n            if (ios) {\n                dom.style.top = ((above ? pos.top - height : pos.bottom) - editor.top) + \"px\";\n                dom.style.left = (left - editor.left) + \"px\";\n                dom.style.position = \"absolute\";\n            }\n            else {\n                dom.style.top = (above ? pos.top - height : pos.bottom) + \"px\";\n                dom.style.left = left + \"px\";\n            }\n            dom.classList.toggle(\"cm-tooltip-above\", above);\n            dom.classList.toggle(\"cm-tooltip-below\", !above);\n            if (tView.positioned)\n                tView.positioned();\n        }\n    }\n    maybeMeasure() {\n        if (this.tooltips.length) {\n            if (this.view.inView || this.inView)\n                this.view.requestMeasure(this.measureReq);\n            this.inView = this.view.inView;\n        }\n    }\n}, {\n    eventHandlers: {\n        scroll() { this.maybeMeasure(); }\n    }\n});\nconst baseTheme = EditorView.baseTheme({\n    \".cm-tooltip\": {\n        position: \"fixed\",\n        zIndex: 100\n    },\n    \"&light .cm-tooltip\": {\n        border: \"1px solid #ddd\",\n        backgroundColor: \"#f5f5f5\"\n    },\n    \"&dark .cm-tooltip\": {\n        backgroundColor: \"#333338\",\n        color: \"white\"\n    }\n});\n// FIXME backward-compat shim. Delete on next major version.\n/**\n@internal\n*/\nfunction tooltips() {\n    return [];\n}\n/**\nBehavior by which an extension can provide a tooltip to be shown.\n*/\nconst showTooltip = Facet.define({\n    enables: [tooltipPlugin, baseTheme]\n});\nconst HoverTime = 750, HoverMaxDist = 6;\nclass HoverPlugin {\n    constructor(view, source, field, setHover) {\n        this.view = view;\n        this.source = source;\n        this.field = field;\n        this.setHover = setHover;\n        this.lastMouseMove = null;\n        this.hoverTimeout = -1;\n        this.restartTimeout = -1;\n        this.pending = null;\n        this.checkHover = this.checkHover.bind(this);\n        view.dom.addEventListener(\"mouseleave\", this.mouseleave = this.mouseleave.bind(this));\n        view.dom.addEventListener(\"mousemove\", this.mousemove = this.mousemove.bind(this));\n    }\n    update() {\n        if (this.pending) {\n            this.pending = null;\n            clearTimeout(this.restartTimeout);\n            this.restartTimeout = setTimeout(() => this.startHover(), 20);\n        }\n    }\n    get active() {\n        return this.view.state.field(this.field);\n    }\n    checkHover() {\n        this.hoverTimeout = -1;\n        if (this.active)\n            return;\n        let now = Date.now(), lastMove = this.lastMouseMove;\n        if (now - lastMove.timeStamp < HoverTime)\n            this.hoverTimeout = setTimeout(this.checkHover, HoverTime - (now - lastMove.timeStamp));\n        else\n            this.startHover();\n    }\n    startHover() {\n        var _a;\n        clearTimeout(this.restartTimeout);\n        let lastMove = this.lastMouseMove;\n        let coords = { x: lastMove.clientX, y: lastMove.clientY };\n        let pos = this.view.contentDOM.contains(lastMove.target)\n            ? this.view.posAtCoords(coords) : null;\n        if (pos == null)\n            return;\n        let posCoords = this.view.coordsAtPos(pos);\n        if (posCoords == null || coords.y < posCoords.top || coords.y > posCoords.bottom ||\n            coords.x < posCoords.left - this.view.defaultCharacterWidth ||\n            coords.x > posCoords.right + this.view.defaultCharacterWidth)\n            return;\n        let bidi = this.view.bidiSpans(this.view.state.doc.lineAt(pos)).find(s => s.from <= pos && s.to >= pos);\n        let rtl = bidi && bidi.dir == Direction.RTL ? -1 : 1;\n        let open = this.source(this.view, pos, (coords.x < posCoords.left ? -rtl : rtl));\n        if ((_a = open) === null || _a === void 0 ? void 0 : _a.then) {\n            let pending = this.pending = { pos };\n            open.then(result => {\n                if (this.pending == pending) {\n                    this.pending = null;\n                    if (result)\n                        this.view.dispatch({ effects: this.setHover.of(result) });\n                }\n            }, e => logException(this.view.state, e, \"hover tooltip\"));\n        }\n        else if (open) {\n            this.view.dispatch({ effects: this.setHover.of(open) });\n        }\n    }\n    mousemove(event) {\n        var _a;\n        this.lastMouseMove = event;\n        if (this.hoverTimeout < 0)\n            this.hoverTimeout = setTimeout(this.checkHover, HoverTime);\n        let tooltip = this.active;\n        if (tooltip && !isInTooltip(event.target) || this.pending) {\n            let { pos } = tooltip || this.pending, end = (_a = tooltip === null || tooltip === void 0 ? void 0 : tooltip.end) !== null && _a !== void 0 ? _a : pos;\n            if ((pos == end ? this.view.posAtCoords({ x: event.clientX, y: event.clientY }) != pos\n                : !isOverRange(this.view, pos, end, event.clientX, event.clientY, HoverMaxDist))) {\n                this.view.dispatch({ effects: this.setHover.of(null) });\n                this.pending = null;\n            }\n        }\n    }\n    mouseleave() {\n        clearTimeout(this.hoverTimeout);\n        this.hoverTimeout = -1;\n        if (this.active)\n            this.view.dispatch({ effects: this.setHover.of(null) });\n    }\n    destroy() {\n        clearTimeout(this.hoverTimeout);\n        this.view.dom.removeEventListener(\"mouseleave\", this.mouseleave);\n        this.view.dom.removeEventListener(\"mousemove\", this.mousemove);\n    }\n}\nfunction isInTooltip(elt) {\n    for (let cur = elt; cur; cur = cur.parentNode)\n        if (cur.nodeType == 1 && cur.classList.contains(\"cm-tooltip\"))\n            return true;\n    return false;\n}\nfunction isOverRange(view, from, to, x, y, margin) {\n    let range = document.createRange();\n    let fromDOM = view.domAtPos(from), toDOM = view.domAtPos(to);\n    range.setEnd(toDOM.node, toDOM.offset);\n    range.setStart(fromDOM.node, fromDOM.offset);\n    let rects = range.getClientRects();\n    range.detach();\n    for (let i = 0; i < rects.length; i++) {\n        let rect = rects[i];\n        let dist = Math.max(rect.top - y, y - rect.bottom, rect.left - x, x - rect.right);\n        if (dist <= margin)\n            return true;\n    }\n    return false;\n}\n/**\nEnable a hover tooltip, which shows up when the pointer hovers\nover ranges of text. The callback is called when the mouse hovers\nover the document text. It should, if there is a tooltip\nassociated with position `pos` return the tooltip description\n(either directly or in a promise). The `side` argument indicates\non which side of the position the pointer is—it will be -1 if the\npointer is before the position, 1 if after the position.\n*/\nfunction hoverTooltip(source, options = {}) {\n    const setHover = StateEffect.define();\n    const hoverState = StateField.define({\n        create() { return null; },\n        update(value, tr) {\n            if (value && (options.hideOnChange && (tr.docChanged || tr.selection)))\n                return null;\n            for (let effect of tr.effects)\n                if (effect.is(setHover))\n                    return effect.value;\n            if (value && tr.docChanged) {\n                let newPos = tr.changes.mapPos(value.pos, -1, MapMode.TrackDel);\n                if (newPos == null)\n                    return null;\n                let copy = Object.assign(Object.create(null), value);\n                copy.pos = newPos;\n                if (value.end != null)\n                    copy.end = tr.changes.mapPos(value.end);\n                return copy;\n            }\n            return value;\n        },\n        provide: f => showTooltip.from(f)\n    });\n    return [\n        hoverState,\n        ViewPlugin.define(view => new HoverPlugin(view, source, hoverState, setHover))\n    ];\n}\n\nexport { hoverTooltip, showTooltip, tooltips };\n"]},"metadata":{},"sourceType":"module"}